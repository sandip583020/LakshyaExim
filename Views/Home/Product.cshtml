@{
    var BaseURL = "https://api.lakshyaexim.in/api/";
    var imageURL = "https://api.lakshyaexim.in";
    var CatagoryList = "";
    var ProductList = "";
    var Product = "";
}

@section Scripts {
    <script type="text/javascript">
        $(document).ready(function () {
            loadProducts(); // Load all products when the page loads
        });

        function loadProducts() {
            $.ajax({
                url: '@BaseURL' + "Product/AllProducts",
                method: 'GET',
                dataType: 'json',
                success: function (result) {
                    var ProductList = result.data.filter(function (product) {
                        return product.isActive === true;
                    });
                    displayProducts(ProductList);
                },
                error: function (error) {
                    console.log(error);
                }
            });
        }


        $.ajax({
            url: '@BaseURL' + "ProductCategory/AllProductCategories",
            method: 'GET',
            dataType: 'json',
            success: function (result) {
                var CatagoryList = result.data;
                CatagoryList.forEach(function (Catagory) {
                    var fullImageUrl = "@imageURL" + Catagory.imagePath;
                    var CatagoryHtml =
                        "<div onclick='ProductCatagoryFunc(" + Catagory.productCategoryID + ")' class='bg-white border p-6 rounded-lg shadow-md hover:shadow-lg cursor-pointer'>" +
                        "<img src='" + fullImageUrl + "' alt='Lavender' class='w-full h-40 object-cover rounded mb-4' />" +
                        "<h2 class='text-xl font-semibold text-center'>" + Catagory.productCategoryName + "</h2>" +
                        "</div>";

                    var dropdownOption = "<option value='" + Catagory.productCategoryID + "'>" + Catagory.productCategoryName + "</option>";

                    $('#Catagory-container').append(CatagoryHtml);
                    $('#Catagory-dropdown').append(dropdownOption);
                });
            },
            error: function (error) {
                $('#cmsData').html('<p>An error has occurred</p>');
                console.log(error);
            }
        });

        // Add event listener for the dropdown
        $('#Catagory-dropdown').on('change', function () {
            var selectedCategoryId = $(this).val();
            ProductCatagoryFunc(selectedCategoryId);
        });

        // Function to handle screen size changes
        function handleScreenSizeChange() {
            if ($(window).width() <= 768) { // Mobile view
                $('#Catagory-container').addClass('hidden');
                $('#Catagory-dropdown').removeClass('hidden');
            } else {
                $('#Catagory-container').removeClass('hidden');
                $('#Catagory-dropdown').addClass('hidden');
            }
        }

        // Initial check and event listener for screen size changes
        $(document).ready(function () {
            handleScreenSizeChange();
            $(window).resize(handleScreenSizeChange);
        });


        function ProductCatagoryFunc(id) {
            $('#Product-Card').empty();

            if (id === 0) {
                loadProducts(); 
                return;
            }

            $.ajax({
                url: '@BaseURL' + "Product/AllProductsCatagoryWiseFilter?ProductCategoryID=" + id,
                method: 'GET',
                dataType: 'json',
                success: function (result) {
                    var ProductList = result.data;
                    var activeProducts = ProductList.filter(function (product) {
                        return product.isActive === true; 
                    });
                    displayProducts(activeProducts);
                },
                error: function (error) {
                    console.log(error);
                }
            });

        }

        function displayProducts(products) {
            products.forEach(function (Product) {
                var fullImageUrl = "@imageURL" + Product.imagePath;
                var ProductCategoryHtml =
                    "<div>" +
                    "<div class='flex flex-wrap justify-center'>" +
                    "<img class='absolute h-[370px] w-[342px] object-cover -z-10' " +
                    "src='/image/productshapepolygon.png' " +
                    "alt='Product Shape' />" +
                    "<img class='h-[331px] w-[319px] object-cover hover:scale-105 transition-transform duration-300' " +
                    "src='" + fullImageUrl + "' " +
                    "alt='Product Image' />" +
                    "</div>" +
                    "<div class='px-6 py-4'>" +
                    "<div class='font-bold text-xl mt-8 mb-2 text-center'>" +
                    Product.productName +
                    "</div>" +
                    "<div class='button-container'>" +
                    "<button class='button' onclick='ProductInfo(" + Product.productID + ")'>Read More</button>" +
                    "</div>" +
                    "</div>" +
                    "</div>";

                $('#Product-Card').append(ProductCategoryHtml);
            });
        }

        function ProductInfo(productId) {
            var url = '/Home/ProductDetails?productId=' + productId;
            window.open(url, '_blank');
        }

    </script>
}


<div>
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold text-center mb-6">
            Essential Oil Categories
        </h1>
        <div class="flex justify-center">
            <div id="Catagory-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6 w-full max-w-7xl"></div>
            <select id="Catagory-dropdown" class="hidden custom-dropdown w-full max-w-7xl p-2 border rounded-md">
                <option value="" disabled selected>Category-specific Product Display</option>
            </select>
        </div>


    </div>

    <div id="Product-Card" class="grid grid-cols-1 md:grid-cols-3 mx-6 mt-20">
    </div>
</div>
